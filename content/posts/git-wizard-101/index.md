+++
title = 'How to become a git wizard in 2 easy steps'
date = 2024-07-09
categories = ['blog']
tags = ['git', 'tools']
draft = true
+++

## So you wanna be a wizard

{{< figure src="git-wizard.jpeg" alt="A cartoon octopus wizard working over a cauldron" caption=`Generated by Copilot: "A cartoon octopus in a wizard hat and robe, casting a spell over a cauldron. The cauldron and the air around it are filled with long strings of hexadecimal numbers."` >}}

There's probably someone you work with who's the person you go to when you really hork your git repo.

"Please," you cry. "I did something wrong in the middle of a rebase and now my changes are GONE!  Can you unhork me, o
great wizard ðŸ¥¹?"

The wizard glances at your screen, a crease furrows their brow, and they begin arcane incantations.  "REFLOG!" they
cry.  "RESET!" they command.  Dashes appear and flags rain down in the terminal.

They sit back, a satisfied smile on their face, dusting their hands.  "There you go."  Your week of work is saved!  The
wizard smiles "Your changes were never gone, you know, they were with you all along."  You thank them profusely and they
walk away dusting their hands.

As you resume your feature, you daydream about gaining such mastery over the forces of the repo.

## The mysteries

I will now induct you into the mysteries of git.  Prepare yourself!

1. A branch is just a pointer to a commit
1. Nothing committed to a git repo ever goes away[^1]

[^1]: Ok this isn't strictly true.  But it's true enough most of the time.

That's pretty much it.  The rest is knowing how to get to the commit you wanted.

### First incantation: `reflog`

A "ref" is anything that refers to a commit.  Branches are refs, and they're stored as ordinary files in your repo's
.git directory.  Here's some the contents of the .git of the repo where I'm writing this blog right now:

```
$ tree .git
...
â”œâ”€â”€ FETCH_HEAD
â”œâ”€â”€ HEAD
â”œâ”€â”€ ORIG_HEAD
...
â”œâ”€â”€ refs
â”‚Â Â  â”œâ”€â”€ heads
â”‚Â Â  â”‚Â Â  â””â”€â”€ main
â”‚Â Â  â”œâ”€â”€ remotes
â”‚Â Â  â”‚Â Â  â””â”€â”€ origin
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ invite
â”‚Â Â  â”‚Â Â      â””â”€â”€ main
â”‚Â Â  â””â”€â”€ tags

```

`refs/heads/main` a file with a single git sha in it, and that's the commit that `main` in my repo refers to right now.
Since I have `main` checked out, the contents of `HEAD` is

```
$ cat .git/HEAD
ref: refs/heads/main
```

So `HEAD` is a ref that refers to a ref that refers to a commit by its sha (a `**commit`, if you will).  It turns out
`git` keeps a record of all the commits that a certain ref has pointed to over time, and this is called the reflog.
There's a command that lets you view and manipulate that log, and it's called, unsurprisingly, `git reflog`. [Here's the
doc ](https://git-scm.com/docs/git-reflog).

This record isn't permanent, it's cleaned up periodically[^2], and it's also not part of the repo.  That it's, it's
local information kept in your `.git` directory, and not pulled or pushed to remotes like Github when you `pull` or
`push`.

[^2]: Exactly how often is controlled by two config values, `gc.reflogExpire` (default = 90 days) and
    `gc.reflogExpireUnreachable` (default = 30 days).  See `git help gc` for more info.
